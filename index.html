<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #1e3c72;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0;
  }
  .login-box {
    background: #fff;
    padding: 30px;
    border-radius: 12px;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  .login-box h2 {
    text-align: center;
    color: #1e3c72;
    margin-bottom: 20px;
  }
  .login-box input {
    width: 100%;
    padding: 12px;
    margin-top: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
  }
  .login-box button {
    width: 100%;
    padding: 12px;
    margin-top: 20px;
    border-radius: 8px;
    border: none;
    background: #2a5298;
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
  }
  .login-box button:hover {
    background: #1e3c72;
  }
  .login-box a {
    display: block;
    text-align: center;
    margin-top: 15px;
    text-decoration: none;
    color: #2a5298;
  }
  #msg {
    margin-top: 15px;
    text-align: center;
    font-weight: 500;
  }
</style>
</head>
<body>

<div class="login-box">
  <h2>Login</h2>
  <input id="email" type="email" placeholder="Email" required>
  <div style="position:relative">
  <input type="password" id="password" placeholder="Password">
  <span onclick="togglePassword()" 
        style="position:absolute;right:12px;top:50%;transform:translateY(-50%);
               cursor:pointer;font-size:13px;color:#2a5298;">
    üëÅ Show
  </span>
</div>

<button id="loginBtn">Login</button>
  <a href="forgot.html" style="float: left; margin-right: 10px;">Forgot Password?</a>
<a href="register.html" style="float: left;">Register</a>


<br>
<hr>
  <p id="msg"></p>
<hr>
</div>

<script>
  const API = "https://script.google.com/macros/s/AKfycbw_qfPCVJVNdTgEdbaKP8RnkA_l7COVoEKLvvpaIeWPvwrTDFYH9cF32mGP9Ow3MEAi7g/exec"; // Replace with your Web App URL
  const loginBtn = document.getElementById("loginBtn");
  const msg = document.getElementById("msg");

  loginBtn.addEventListener("click", function() {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();

    if(!email || !password){
      msg.style.color = "red";
      msg.innerText = "Please enter both email and password.";
      return;
    }

    // Show logging in message and disable button
    msg.style.color = "#1e3c72";
    msg.innerText = "Logging in...";
    loginBtn.disabled = true;
    loginBtn.style.opacity = "0.6";

    fetch(API, {
      method: "POST",
      body: JSON.stringify({
        action: "login",
        email: email,
        password: password
      })
    })
    .then(response => response.json())
    .then(res => {
      // Re-enable button
      loginBtn.disabled = false;
      loginBtn.style.opacity = "1";

      if(res.success){
        localStorage.setItem("sessionToken", res.token);
        localStorage.setItem("lastActivity", Date.now());
        msg.style.color = "green";
        msg.innerText = "Login successful! Redirecting...";
        setTimeout(() => {
          window.location.href = "success.html"; // Protected page
        }, 1000);
      }
      else if(res.reason === "blocked"){
        msg.style.color = "red";
        msg.innerText = "Your account has been blocked. Contact support.";
      }
      else{
        msg.style.color = "red";
        msg.innerText = "Invalid email or password.";
      }
    })
    .catch(err => {
      console.error(err);
      loginBtn.disabled = false;
      loginBtn.style.opacity = "1";
      msg.style.color = "red";
      msg.innerText = "Error connecting to server.";
    });
  });
</script>
<script>
function togglePassword() {
  const pwd = document.getElementById("password");
  const toggle = event.target;

  if (pwd.type === "password") {
    pwd.type = "text";
    toggle.textContent = "üôà Hide";
  } else {
    pwd.type = "password";
    toggle.textContent = "üëÅ Show";
  }
}
</script>
</body>
</html>
